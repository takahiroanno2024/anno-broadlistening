# build stage
FROM node:22-alpine AS build-stage

ARG REPORT

WORKDIR /workspace

COPY scatter/report /workspace/report
COPY scatter/pipeline/outputs/${REPORT}/hierarchical_result.json /workspace/pipeline/outputs/${REPORT}/hierarchical_result.json
COPY scatter/pipeline/outputs/${REPORT}/metadata.json /workspace/pipeline/outputs/${REPORT}/metadata.json
COPY scatter/pipeline/outputs/${REPORT}/reporter.png /workspace/pipeline/outputs/${REPORT}/reporter.png
COPY scatter/pipeline/outputs/${REPORT}/icon.png /workspace/pipeline/outputs/${REPORT}/icon.png

RUN cd report && npm install && npm run build

# runtime stage
FROM node:22-alpine AS runtime-stage

WORKDIR /workspace

RUN npm install -g serve

ARG REPORT

COPY --from=build-stage /workspace/pipeline/outputs/${REPORT}/report /workspace/out

ENV PORT="8080"

CMD ["serve", "-s", "/workspace/out", "-l", "8080"]
